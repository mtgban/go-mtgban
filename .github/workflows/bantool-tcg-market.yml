name: tcg_market

on:
  workflow_dispatch: {}
  repository_dispatch:
    types: [tcg_market]
  schedule:
    - cron: "25 * * * *"

concurrency:
  group: bantool-tcgplayer
  cancel-in-progress: false

jobs:
  cache-datastore:
    uses: ./.github/workflows/cache-file.yml
    with:
      url: ${{ vars.DATASTORE_MAGIC }}
      path: "datastore/"
    secrets: inherit

  cache-skus:
    uses: ./.github/workflows/cache-file.yml
    with:
      url: ${{ vars.SKUS_MAGIC }}
      path: "datastore/"
    secrets: inherit

  deploy:
    name: ${{ github.workflow }}
    needs: [cache-datastore, cache-skus]
    uses: ./.github/workflows/run-bantool.yml
    with:
      target: ${{ github.workflow }}
      game: "magic"
      datastore-filepath: ${{ needs.cache-datastore.outputs.filepath }}
      datastore-cache-key: ${{ needs.cache-datastore.outputs.key }}
      skus-filepath: ${{ needs.cache-skus.outputs.filepath }}
      skus-cache-key: ${{ needs.cache-skus.outputs.key }}
    secrets: inherit
